<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>录音</title>

    <link rel="stylesheet" type="text/css" th:href="@{/plugins/report/css/nav.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/plugins/report/css/iconfont.css}" >
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/plugins/bootstrapTable/css/bootstrap-table.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/font-awesome.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/css/smartadmin-production.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/css/smartadmin-production-plugins.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{/plugins/jplayer/jplayer.blue.monday.min.css}" >
</head>
<body class="smart-style-0 desktop-detected" style="cursor: auto;">
<div class="nav">
    <div class="nav-top">
        <div id="mini" ><img th:src="@{/plugins/report/images/mini.png}" ></div>
    </div>
    <ul>
        <li class="nav-item nav-show">
            <a href="#"><i class="my-icon nav-icon icon_1"></i><span>录音列表</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="/record"><span>录音收藏夹</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="#"><i class="my-icon nav-icon icon_2"></i><span>统计报表</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="/report_total_everydays"><span>总体话务量日报表</span></a></li>
                <li><a href="/report_total_months"><span>话务年统计报表</span></a></li>
                <li><a href="/report_total_years"><span>总体话务量年报表</span></a></li>
                <li><a href="/report_total_agent"><span>坐席话务量报表</span></a></li>
                <li><a href="/report_evaluate_agent"><span>坐席话务评价报表</span></a></li>
                <li><a href="/report_average_agent"><span>坐席人均话务报表</span></a></li>
                <li><a href="#"><span>坐席话务量日统计报表</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="#"><i class="my-icon nav-icon icon_3"></i><span>明细表</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a href="/agent_call_detail"><span>坐席话务明细表</span></a></li>
                <li><a href="/agent_status_detail"><span>坐席状态明细表</span></a></li>
            </ul>
        </li>
    </ul>
</div>

<div id="main" role="main">
    <div id="content">
        <section id="widget-grid" class="">
            <div class="row">
                <article class="col-xs-12">
                    <div class="jarviswidget" id="wid-id-0" data-widget-editbutton="false">
                        <header>
                            <h2><strong>录音列表</strong></h2>
                        </header>
                        <div>
                            <div class="widget-body">
                                <table id="recordTable"></table>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
        </section>
    </div>
</div>
<!-- 播放音频START -->
<div class="modal fade" id="recordModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    播放录音
                </h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-12" style="padding: 1px;">
                        <div class="widget-box shadow-box">
                            <div style="padding:5px ;margin-left: 70px;"  >
                                <div id="jquery_jplayer" class="jp-jplayer"></div>
                                <div id="jp_container_1" class="jp-audio" role="application" aria-label="media player">
                                    <div class="jp-type-single">
                                        <div class="jp-gui jp-interface">
                                            <div class="jp-controls">
                                                <button class="jp-play" role="button" tabindex="0">play</button>
                                                <button class="jp-stop" role="button" tabindex="0">stop</button>
                                            </div>
                                            <div class="jp-progress">
                                                <div class="jp-seek-bar">
                                                    <div class="jp-play-bar"></div>
                                                </div>
                                            </div>
                                            <div class="jp-volume-controls">
                                                <button class="jp-mute" role="button" tabindex="0">mute</button>
                                                <button class="jp-volume-max" role="button" tabindex="0">max volume</button>
                                                <div class="jp-volume-bar">
                                                    <div class="jp-volume-bar-value"></div>
                                                </div>
                                            </div>
                                            <div class="jp-time-holder">
                                                <div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
                                                <div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
                                                <div class="jp-toggles">
                                                    <button class="jp-repeat" role="button" tabindex="0">repeat</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="jp-details">
                                            <div class="jp-title" aria-label="title">&nbsp;</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    关闭
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>
<script th:src="@{/js/jquery-2.1.4.min.js}"></script>
<script th:src="@{/js/jquery-ui.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/report/js/nav.js}" ></script>
<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrapTable/js/bootstrap-table.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrapTable/js/bootstrap-table-zh-CN.min.js}"></script>
<script type="text/javascript" th:src="@{/js/jarvis.widget.min.js}"></script>
<script type="text/javascript" th:src="@{/plugins/jplayer/jquery.jplayer.min.js}"></script>
<script>
    $(function () {
        $('#recordTable').bootstrapTable({
            url : "/records",  //请求后台的URL（*）
            method : "POST" , //请求方式（*）
            contentType:"application/x-www-form-urlencoded; charset=UTF-8",
           // toolbar : "#usertoolbar" , //工具按钮用哪个容器
            striped: true , //是否显示行间隔色
            cache: false ,  //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            pagination: true , //是否显示分页（*）
            sortable: true ,  //是否启用排序
            sortOrder: "asc" , //排序方式
            sidePagination: "server" , //分页方式：client客户端分页，server服务端分页（*）
            queryParamsType : "limit",
            pageNumber: 1 , //初始化加载第一页，默认第一页
            pageSize: 10 , //每页的记录行数（*）
            pageList: [10, 25, 50, 100] , //可供选择的每页的行数（*）
            search: true , //是否显示表格搜索，此搜索是客户端搜索，不会进服务端
            strictSearch: false ,
            showColumns: true , //是否显示所有的列
            showRefresh: false , //是否显示刷新按钮
            minimumCountColumns: 2 , //最少允许的列数
            clickToSelect: true , //是否启用点击选中行
            uniqueId: "ID" , //每一行的唯一标识，一般为主键列
            showToggle: false , //是否显示详细视图和列表视图的切换按钮
            cardView: false ,   //是否显示详细视图
            detailView: false ,
            queryParams : function (params){
                var temp = {
                    limit : params.limit ,
                    page : params.offset/params.limit  ,
                    keywords : params.search ,
                    sort : params.sort ,
                    order : params.order,
                    pageNumber : this.pageNumber,
                    pageSize : this.pageSize
                }
                return temp;
            } ,     //传递参数（*）
            columns: [{
                field : 'ucid',
                title : "电话编号",
                align: 'center',
                valign: 'middle'
            },{
                field : 'agent_no',
                title : "工号",
                align: 'center',
                valign: 'middle',
                sortable:true
            },{
                field : 'calling_no',
                title : "主叫号码",
                align: 'center',
                valign: 'middle',
                sortable:true
            },{
                field : 'called_no',
                title : "被叫号码",
                align: 'center',
                valign: 'middle',
                sortable:true
            },{
                field : 'file_name',
                title : "文件名",
                align: 'center',
                valign: 'middle'
            },{
                field : 'direction' ,
                title : "方向",
                align: 'center',
                valign: 'middle',
                sortable:true,
                formatter:function (value, row, index) {
                    if(value==0){
                        return "呼入";
                    }else if(value==1){
                        return "呼出";
                    }else{
                        return "内线";
                    }
                }
            },{
                field : 'end_time' ,
                title : "收藏时间",
                align: 'center',
                valign: 'middle',
                sortable : true,
                formatter: function (value, row, index) {
                    return dateToStr(value);
                }
            },{
                title : "操作",
                align: 'center',
                valign: 'middle',
                formatter: function (value, row, index) {
                    return '<div >' +
                        '<button class="btn btn-xs btn-info" title="下载" onclick="download(\''+row.file_name+'\')">'+
                        '<i class="ace-icon fa fa-cloud-download bigger-120"></i>'+
                        '</button>&nbsp;&nbsp;'+
                        '<button class="btn btn-xs btn-danger" title="播放" onclick="playRecord(&apos;'+row.file_name+'&apos;)" >'+
                        '<i class="ace-icon fa fa-play-circle bigger-120"></i>'+
                        '</button>'+
                        '</div>' ;
                }
            }],
            onLoadSuccess: function(){  //加载成功时执行
            }
        });

        $.fn.jarvisWidgets && $("#widget-grid").jarvisWidgets({
            grid: "article",
            widgets: ".jarviswidget",
            localStorage: true,
            deleteSettingsKey: "#deletesettingskey-options",
            settingsKeyLabel: "Reset settings?",
            deletePositionKey: "#deletepositionkey-options",
            positionKeyLabel: "Reset position?",
            sortable: !0,
            buttonsHidden: !1,
            toggleButton: !0,
            toggleClass: "fa fa-minus | fa fa-plus",
            toggleSpeed: 200,
            onToggle: function() {},
            deleteButton: !0,
            deleteMsg: "Warning: This action cannot be undone!",
            deleteClass: "fa fa-times",
            deleteSpeed: 200,
            onDelete: function() {},
            editButton: !0,
            editPlaceholder: ".jarviswidget-editbox",
            editClass: "fa fa-cog | fa fa-save",
            editSpeed: 200,
            onEdit: function() {},
            colorButton: !0,
            fullscreenButton: !0,
            fullscreenClass: "fa fa-expand | fa fa-compress",
            fullscreenDiff: 3,
            onFullscreen: function() {},
            customButton: !1,
            customClass: "folder-10 | next-10",
            customStart: function() {
                alert("Hello you, this is a custom button...")
            },
            customEnd: function() {
                alert("bye, till next time...")
            },
            buttonOrder: "%refresh% %custom% %edit% %toggle% %fullscreen% %delete%",
            opacity: 1,
            dragHandle: "> header",
            placeholderClass: "jarviswidget-placeholder",
            indicator: !0,
            indicatorTime: 600,
            ajax: !0,
            timestampPlaceholder: ".jarviswidget-timestamp",
            timestampFormat: "Last update: %m%/%d%/%y% %h%:%i%:%s%",
            refreshButton: !0,
            refreshButtonClass: "fa fa-refresh",
            labelError: "Sorry but there was a error:",
            labelUpdated: "Last Update:",
            labelRefresh: "Refresh",
            labelDelete: "Delete widget:",
            afterLoad: function() {},
            rtl: !1,
            onChange: function() {},
            onSave: function() {}
            //ajaxnav: $.navAsAjax
        })
    })

    function download(fileName) {
        window.location.href = "http://172.17.3.225:8070/MyService/GetMediaStream?name="+fileName;
    }

    function playRecord(fileName) {
        $("#recordModal").modal({keyboard : false});
        $("#jquery_jplayer").jPlayer({
            ready: function () {
                $(this).jPlayer("setMedia", {
                    title: "Bubble",
                    mp3: "http://172.17.3.225:8070/MyService/GetMediaStream?name"+fileName
                });
            },
            swfPath: "/plugins/jplayer",
            supplied: "mp3",
            wmode: "window",
            useStateClassSkin: true,
            autoBlur: false,
            smoothPlayBar: true,
            keyEnabled: true,
            remainingDuration: true,
            toggleDuration: true
        });
    }

    function dateToStr(datetime){
        var datetime = new Date(datetime)
        var year = datetime.getFullYear();
        var month = datetime.getMonth()+1;//js从0开始取
        var date = datetime.getDate();
        var hour = datetime.getHours();
        var minutes = datetime.getMinutes();
        var second = datetime.getSeconds();

        if(month<10){
            month = "0" + month;
        }
        if(date<10){
            date = "0" + date;
        }
        if(hour <10){
            hour = "0" + hour;
        }
        if(minutes <10){
            minutes = "0" + minutes;
        }
        if(second <10){
            second = "0" + second ;
        }

        var time = year+"-"+month+"-"+date+" "+hour+":"+minutes+":"+second; //2009-06-12 17:18:05
        return time;
    }
</script>
</body>
</html>