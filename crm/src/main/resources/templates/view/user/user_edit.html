<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/ace/ace.min.css}">
    <link rel="stylesheet" th:href="@{/plugins/selectZtree/import_fh.css}">
    <link rel="stylesheet" th:href="@{/plugins/selectZtree/ztree/ztree.css}">
    <link rel="stylesheet" th:href="@{/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css}">
</head>
<body class="no-skin">
<div class="main-container" id="main-container">
    <div class="main-content">
        <div class="main-content-inner">
            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <form class="form-horizontal" role="form" th:action="@{/user}" id="userForm" method="post">
                            <div id="zhongxin" style="padding-top: 13px;"></div>
                            <input type="hidden" name="_method" value="put" th:if="${user!=null}"/>
                            <input type="hidden" name="userId"  th:if="${user!=null}" th:value="${user!=null}?${user.userId}">
                            <table id="table_report" class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td class="utd">姓名：</td>
                                    <td>
                                        <input  type="text"  id="name" th:name="name" maxlength="32"
                                                placeholder="这里输入姓名" title="姓名" style="width:98%;" th:value="${user!=null}?${user.name}">
                                    </td>
                                    <td class="utd">工号：</td>
                                    <td style="width: 200px;">
                                        <input readonly="readonly"  type="text"  id="number" name="number" maxlength="32"
                                                placeholder="这里输入工号" title="工号" style="width:98%;" th:value="${user!=null}?${user.number}:${maxNumber}">
                                    </td>
                                    <td class="utd">性别：</td>
                                    <td>
                                        <select id="sex" name="sex" style="width:98%;" >
                                            <option th:value="0" th:selected="${user!=null}?${user.sex==0}" >男</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.sex==1}">女</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="utd">电话号码：</td>
                                    <td>
                                        <input  type="text" name="phone" id="phone"  maxlength="32"
                                                placeholder="这里输入电话号码" title="电话号码" style="width:98%;"
                                                th:value="${user!=null}?${user.phone}">
                                    </td>
                                    <td class="utd">手机号码：</td>
                                    <td>
                                        <input  type="text" name="telephone" id="telephone"  maxlength="32"
                                                placeholder="这里输入手机号码" title="手机号码" style="width:98%;"
                                                th:value="${user!=null}?${user.telephone}">
                                    </td>
                                    <td class="utd">出生日期：</td>
                                    <td>
                                        <input class="span10 date-picker" name="bornDay" id="bornDay"
                                               th:value="${user!=null}?${user.bornDay}" type="text"
                                               data-date-format="yyyy-mm-dd"
                                               readonly="readonly" placeholder="出生日期" title="出生日期"
                                               style="width:98%;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="utd">所在部门：</td>
                                    <td id="deps" colspan="3">
                                        <input  type="hidden" name="depId" id="depId"  maxlength="32"
                                                 th:value="${user!=null}?${user.depId}">
                                        <div class="selectTree" id="selectTree" trueType="selectTree"></div>
                                    </td>

                                    <td class="utd">职务：</td>
                                    <td>
                                        <input  type="text"  id="job" th:name="job" maxlength="32"
                                                placeholder="这里输入职务" title="职务" style="width:98%;"
                                                th:value="${user!=null}?${user.job}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="utd">角色：</td>
                                    <td id="roles" colspan="5">
                                        <input  type="hidden" name="roleIds" id="roleIds"
                                                th:value="${user!=null}?${user.roleIds}">
                                        <div class="selectTree" id="selectRoleTree" trueType="selectTree" allSelectable="true" multiMode ="true" ></div>
                                    </td>
                                </tr>


                            </table>
                            <table id="table_report1" class="table table-striped table-bordered table-hover">
                                <tr>
                                    <td class="utd">民族：</td>
                                    <td>
                                        <input  type="text"  id="nation" th:name="nation" maxlength="32"
                                                placeholder="这里输入民族" title="民族" style="width:98%;"
                                                th:value="${user!=null}?${user.nation}">
                                    </td>
                                    <td class="utd">效力状态：</td>
                                    <td >
                                        <select id="status" name="status" style="width:98%;">
                                            <option th:value="0" th:selected="${user!=null}?${user.status==0}">有效</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.status==1}">失效</option>
                                        </select>
                                    </td>
                                    <td class="utd">婚姻状况：</td>
                                    <td>
                                        <select id="maritalStatus" name="maritalStatus" style="width:98%;">
                                            <option th:value="0" th:selected="${user!=null}?${user.maritalStatus==0}">未婚</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.maritalStatus==1}">已婚</option>
                                            <option th:value="2" th:selected="${user!=null}?${user.maritalStatus==2}">离异</option>
                                            <option th:value="3" th:selected="${user!=null}?${user.maritalStatus==3}">丧偶</option>
                                            <option th:value="4" th:selected="${user!=null}?${user.maritalStatus==4}">未知</option>
                                        </select>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="utd">健康状况：</td>
                                    <td >
                                        <input  type="text"  id="health" th:name="health" maxlength="32"
                                                placeholder="这里输入健康状况" title="健康状况" style="width:98%;"
                                                th:value="${user!=null}?${user.health}">
                                    </td>
                                    <td class="utd">方言技能：</td>
                                    <td >
                                        <input  type="text"  id="skill" th:name="skill" maxlength="32"
                                                placeholder="这里输入方言技能" title="方言技能" style="width:98%;"
                                                th:value="${user!=null}?${user.skill}">
                                    </td>
                                    <td class="utd">入职时间：</td>
                                    <td >
                                        <input class="span10 date-picker" name="intoCompanyDate" id="intoCompanyDate"
                                               th:value="${user!=null}?${user.intoCompanyDate}" type="text"
                                               data-date-format="yyyy-mm-dd"
                                               readonly="readonly" placeholder="入职时间" title="入职时间"
                                               style="width:98%;"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="utd">血型：</td>
                                    <td >
                                        <select id="bloodType" name="bloodType" style="width:98%;">
                                            <option th:value="0" th:selected="${user!=null}?${user.bloodType==0}">O</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.bloodType==1}">A</option>
                                            <option th:value="2" th:selected="${user!=null}?${user.bloodType==2}">B</option>
                                            <option th:value="3" th:selected="${user!=null}?${user.bloodType==3}">AB</option>
                                        </select>
                                    </td>
                                    <td class="utd">邮箱：</td>
                                    <td>
                                        <input  type="text"  id="email" th:name="email" maxlength="32"
                                                placeholder="这里输入邮箱" title="邮箱" style="width:98%;"
                                                th:value="${user!=null}?${user.email}">
                                    </td>
                                    <td class="utd">邮政编码：</td>
                                    <td>
                                        <input  type="text"  id="postalCode" th:name="postalCode" maxlength="32"
                                                placeholder="这里输入邮政编码" title="邮政编码" style="width:98%;"
                                                th:value="${user!=null}?${user.postalCode}">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="utd">是否租用：</td>
                                    <td >
                                        <select id="rent" name="rent" style="width:98%;">
                                            <option th:value="0" th:selected="${user!=null}?${user.rent==0}">是</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.rent==1}">否</option>
                                        </select>
                                    </td>
                                    <td class="utd">机楼：</td>
                                    <td>
                                        <input  type="text"  id="floor" th:name="floor" maxlength="32"
                                                placeholder="这里输入机楼" title="机楼" style="width:98%;"
                                                th:value="${user!=null}?${user.floor}">
                                    </td>
                                    <td class="utd">用户类型：</td>
                                    <td >
                                        <select id="userType" name="userType" style="width:98%;">
                                            <option th:value="0" th:selected="${user!=null}?${user.userType==0}">临时</option>
                                            <option th:value="1" th:selected="${user!=null}?${user.userType==1}">正式</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td >身份证号：</td>
                                    <td colspan="5">
                                        <input  type="text"  id="IDNumber" th:name="IDNumber" maxlength="32"
                                                placeholder="这里输入身份证号" title="身份证号" style="width:98%;"
                                                th:value="${user!=null}?${user.IDNumber}">
                                    </td>

                                </tr>
                                <tr>
                                    <td >通讯地址：</td>
                                    <td colspan="5">
                                        <input  type="text"  id="address" th:name="address" maxlength="64"
                                                placeholder="这里输入通讯地址" title="通讯地址" style="width:98%;"
                                                th:value="${user!=null}?${user.address}">
                                    </td>
                                </tr>
                            </table>
                            <table id="table_report2" class="table table-striped table-bordered table-hover">
                                <tr>
                                <tr>
                                    <td class="utd">备注:</td>
                                    <td><input type="text" name="remark" id="remark" th:value="${user!=null}?${user.remark}"
                                               maxlength="255" placeholder="这里输入备注" title="备注" style="width:98%;"/></td>
                                </tr>
                                </tr>
                                <tr>
                                    <td style="text-align: center;" colspan="10">
                                        <a shiro:hasPermission="user:update" class="btn btn-mini btn-primary" onclick="save()">保存</a>
                                        <a class="btn btn-mini btn-danger" onclick="top.Dialog.close();">取消</a>
                                    </td>

                                </tr>
                            </table>
                        </form>
                        <div id="zhongxin2" class="center" style="display:none">
                            <img th:src="@{/img/jzx.gif}" style="width: 50px;"><br/>
                            <h4 class="lighter block green"></h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/jquery-1.7.2.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/plugins/selectZtree/selectTree.js}"></script>
<script th:src="@{/plugins/selectZtree/ztree/ztree.js}"></script>
<script th:src="@{/js/ace/ace.min.js}"></script>
<script th:src="@{/plugins/tips/jquery.tips.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js}"></script>
<script type="text/javascript" th:src="@{/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.zh-CN.js}"></script>
<script th:inline="javascript">
    top.hideMask();
    $("#bornDay").datetimepicker({minView: 2,autoclose: 1,clearBtn:true,todayBtn: 1});

    $("#intoCompanyDate").datetimepicker({minView: 2,autoclose: 1,clearBtn:true,todayBtn: 1});
    var defaultNodes = {"treeNodes":eval([[${depss}]])};
    var roleNodes = {"treeNodes":eval([[${roless}]])};
    //绑定change事件
    $("#selectTree").bind("change",function(){
        if(!$(this).attr("relValue")){
            //  top.Dialog.alert("没有选择节点");
        }else{
            //alert("选中节点文本："+$(this).attr("relText")+"<br/>选中节点值："+$(this).attr("relValue"));
            $("#depId").val($(this).attr("relValue"));
        }
    });
    $("#selectRoleTree").bind("change",function(){
        if(!$(this).attr("relValue")){
            //  top.Dialog.alert("没有选择节点");
        }else{
            //alert("选中节点文本："+$(this).attr("relText")+"<br/>选中节点值："+$(this).attr("relValue"));
            $("#roleIds").val($(this).attr("relValue"));
        }
    });
    //赋给data属性
    $("#selectTree").data("data",defaultNodes);
    $("#selectTree").selectTreeRender();
    $("#selectRoleTree").data("data",roleNodes);
    $("#selectRoleTree").selectTreeRender();
    var user = [[${user}]];
    if(user!=null){
        if(user.dep!=null){
            $("#deps #selectTree2_input").val(user.dep.depName);
        }
    }
    if(user!=null){
        console.log(user);
        var roleNames ="";
        if(user.roles!=null){
            $.each(user.roles,function (i,o) {
                if(i==0){
                    roleNames += o.roleName;
                }else{
                    roleNames += ","+o.roleName;
                }

            })
            $("#selectTree3_input").val(roleNames);
        }
    }
    $(".selectbox").css("width","314px");

    function save() {

        if($("#name").val()==""){
            $("#name").tips({
                side:3,
                msg:'输入姓名',
                bg:'#AE81FF',
                time:2
            });
            $("#name").focus();
            return false;
        }
        if($("#depId").val()==""){
            $("#deps").tips({
                side:3,
                msg:'选择部门',
                bg:'#AE81FF',
                time:2
            });
            return false;
        }

        if($("#email").val()!=""){
            var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
            if (!myreg.test($("#email").val())) {
                $("#email").tips({
                    side:3,
                    msg:'请正确的输入邮箱',
                    bg:'#AE81FF',
                    time:2
                });
                return false;
            }
            }
        if($("#telephone").val()!=""){
            var PhoneReg = /^1[0-9]{10}$/;
            if (!PhoneReg.test($("#telephone").val())) {
                $("#telephone").tips({
                    side:3,
                    msg:'请正确的输入电话号码',
                    bg:'#AE81FF',
                    time:2
                });
                return false;
            }
        }
        $("#userForm").submit();
        $("#zhongxin").hide();
        $("#zhongxin2").show();
    }
</script>
</body>
</html>