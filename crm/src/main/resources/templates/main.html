<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" >
    <meta charset="utf-8" >
    <title>深圳巴士客服系统</title>

    <meta name="description" content="" >
    <meta name="viewport" content="width=device-width, initial-scgale=1.0, maximum-scale=1.0" >
    <link rel="icon" th:href="@{img/icon/bus3.ico}" />
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" type="text/css" th:href="@{css/bootstrap.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{css/font-awesome.min.css}" >
    <link rel="stylesheet" type="text/css" th:href="@{css/liMarquee.css}" >
    <!-- ace styles -->
    <link rel="stylesheet" th:href="@{css/ace/ace.min.css}"  class="ace-main-stylesheet" id="main-ace-style" >
    <!-- ie9取消此注释
    <link rel="stylesheet" th:href="@{css/ace/ace-part2.min.css}" class="ace-main-stylesheet" >
    -->
    <link rel="stylesheet" th:href="@{css/ace/ace-skins.min.css}" >
    <link rel="stylesheet" th:href="@{css/ace/ace-rtl.min.css}" >
    <!--ie9开启此注释
     <link rel="stylesheet"  th:href="@{css/ace/ace-ie.min.css}"  />
    -->
    <!-- ace settings handler -->
    <script th:src="@{js/ace/ace-extra.min.js}" ></script>
    <!--ie8开启此注释
    <script th:src="@{js/ace/html5shiv.min.js}" ></script>
    <script th:src="@{js/ace/respond.min.js}" ></script>-->
    <link th:href="@{css/main.css}" rel="stylesheet">
    <link th:href="@{plugins/dialog/style.css}" rel="stylesheet">
</head>

<body class="no-skin">
<div id="navbar" class="navbar navbar-default    ace-save-state">
    <div class="navbar-container ace-save-state" id="navbar-container">
        <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
            <span class="sr-only">Toggle sidebar</span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>
        </button>

        <div class="navbar-header pull-left">
            <a href="index.html" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    CRM
                </small>
            </a>
        </div>
        <div class="navbar-header pull-left softphone">
            <link rel="stylesheet" th:href="@{css/softphone.css}">
            <link rel="stylesheet" th:href="@{/plugins/toastr/toastr.min.css}">
            <ul class="softlist">
                <li class="functionPhone loginShow" onclick="setAgentState(0)">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/weidenglu.png}" alt="签入" title="签入">
                    </div>
                </li>
                <li class="functionPhone busy" onclick="setAgentState(2)">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/busy.png}" alt="示忙" title="示忙">
                    </div>
                </li>
                <li class="functionPhone free" onclick="setAgentState(3)">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/free.png}" alt="示闲" title="示闲">
                    </div>
                </li>
                <li class="functionPhone answer" onclick="answerPhone()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/Listening.png}"  alt="应答" title="应答">
                    </div>
                </li>
                <li class="functionPhone split" onclick="dropPhone()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/split.png}"  alt="挂断" title="挂断">
                    </div>
                </li>
                <li class="functionPhone dialout" onclick="showDail()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/dial.png}" alt="呼出" title="呼出">
                    </div>
                </li>
                <li class="functionPhone hold" onclick="holdPhone()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/keep.png}"  alt="保持" title="保持">
                    </div>
                </li>
                <li class="functionPhone transfer" onclick="transferPhone()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/transfer.png}"  alt="咨询" title="咨询">
                    </div>
                </li>
                <li class="functionPhone meeting" onclick="meetIng()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/tripartite.png}"  alt="会议" title="会议">
                    </div>
                </li>
                <li class="functionPhone satisfaction" onclick="satisfaction()">
                    <div class="phoneImg">
                        <img th:src="@{/img/softphone/phone/satisfaction.png}"  alt="评价" title="评价">
                    </div>
                </li>
            </ul>
            <script th:src="@{js/jquery-2.1.1.min.js}"></script>
            <script th:src="@{plugins/toastr/toastr.min.js}"></script>
            <script th:src="@{plugins/softphone/jquery.signalR-2.2.1.min.js}"></script>
            <script th:inline="javascript">
                toastr.options = {
                    closeButton: true,                                            // 是否显示关闭按钮，（提示框右上角关闭按钮）
                    debug: false,                                                    // 是否使用deBug模式
                    progressBar: true,                                            // 是否显示进度条，（设置关闭的超时时间进度条）
                    positionClass: "toast-bottom-right",              // 设置提示款显示的位置
                    onclick: null,                                                     // 点击消息框自定义事件
                    showDuration: "300",                                      // 显示动画的时间
                    hideDuration: "1000",                                     //  消失的动画时间
                    timeOut: "1000",                                             //  自动关闭超时时间
                    extendedTimeOut: "1000",                             //  加长展示时间
                    showEasing: "swing",                                     //  显示时的动画缓冲方式
                    hideEasing: "linear",                                       //   消失时的动画缓冲方式
                    showMethod: "fadeIn",                                   //   显示时的动画方式
                    hideMethod: "fadeOut"                                   //   消失时的动画方式
                };
                var callserver =  $.hubConnection("http://172.17.3.225:811/signalr");
                var ext = [[${session.user.phone}]];
                if(ext==null||ext==null||ext==undefined ){
                    toastr.error("当前坐席没有关联分机号");
                }
                $.get("/Callerid",{},function(data){
                    var Callerid = data;
                    $("body").append(Callerid);
                });
                $.get("/dialPhone",{},function(data){
                    var dialPhone = data;
                    $("body").append(dialPhone);
                });
                $.get("/minS",{},function(data){
                    var minS = data;
                    $("body").append(minS);
                });
                $.get("/Callerid1",{},function(data){
                    var Callerid1 = data;
                    $("body").append(Callerid1);
                });
                var agentNum = [[${session.user.number}]];
                var call = callserver.createHubProxy("ctiHub");
                callserver.stateChanged(connectionStateChanged);
                callserver.connectionSlow(connectionSlow);
                call.on("sendResponse", sendResponse);//4.3	回送给坐席要求的动作情况
                call.on("onInbound", onInbound);//4.1	来电弹屏事件
                var chatMessage = "" ;
                var timer;//计时器
                //拨号盘start
                var phoneNum = {
                    '48':'0',
                    '49':'1',
                    '50':'2',
                    '51':'3',
                    '52':'4',
                    '53':'5',
                    '54':'6',
                    '55':'7',
                    '56':'8',
                    '57':'9',
                    '96':'0',
                    '97':'1',
                    '98':'2',
                    '99':'3',
                    '100':'4',
                    '101':'5',
                    '102':'6',
                    '103':'7',
                    '104':'8',
                    '105':'9'
                }/*
                callserver.start().done(function() {
                    //注册
                    call.invoke("req_Register",ext).done(function(val){
                        if(val){
                            toastr.success("注册成功")
                        }else{
                            toastr.error("注册成功")
                        }
                    });
                });*/
                //根据在线状态提示相应的操作
                function connectionStateChanged(state){
                    var stateConversion = {0: 'connecting', 1: 'connected', 2: 'reconnecting', 4: 'disconnected'};
                    console.log('SignalR state changed from: ' + stateConversion[state.oldState]
                        + ' to: ' + stateConversion[state.newState]);
                    if(state.newState==4){
                        toastr.error("您与服务器已中断，请检测网络配置");
                        setTimeout(function(){
                            callserver.start().done(function() {});
                        },5000);
                    }
                    if(state.newState==2){
                        toastr.error("网络出现故障，系统正在重连，请稍候...");
                    }
                    if(state.newState==1){
                        toastr.success("服务器连接成功");
                    }
                }
                //网络延迟时
                function connectionSlow(){
                    toastr.warning("网络延时");
                }

                function sendResponse(retValue,request,cause){
                    console.log(retValue+"==========="+request+"**************");
                    switch(request){
                        case 0 ://来电应答
                            if(retValue=="0"){//应答成功
                                setTime(0);//开始计时
                                $('.phoneanswer').css('background','#fff none repeat scroll 0 0');
                                $('.phoneanswer').html('');
                                $('.endListen').css('display','none');
                            }else{
                                toastr.error("应答失败，请联系管理员");
                            }
                            break;
                        case 1 ://挂断座机
                            if(retValue=="0"){
                                phoneIng = false ;
                            }else{
                                toastr.error("挂断座机失败，请联系管理员");
                            }
                            break;
                        case 2 ://保持
                            if(retValue=="0"){
                                //保持图标变亮
                                $('.hold img').prop('src','img/softphone/phone/keepafter.png');
                            }else{
                                toastr.error("保持失败，请联系管理员");
                            }
                            break;
                        case 3 ://取消保持
                            if(retValue=="0"){
                                keeping = false ;
                                $('.hold img').prop('src','img/softphone/phone/keep.png');
                                $('.hold p').html('保持').css('color','#bbb');
                            }else{
                                toastr.error("取消保持失败，请联系管理员");
                            }
                            break;
                        case 4 :
                            if(retValue=="0"){//转接成功
                                $('.transfer img').prop('src','img/softphone/phone/transfer.png');//咨询图标变暗
                                $('.transfer').find('p').css('color','#bbb');
                                phoneIng = false ;//转为非通话状态
                                transferIng = false;//咨询状态为false
                                $('.callOut1').html('即将转接');
                                $('.callOut').html('通话即将结束');
                                $('.callTime').html('');//清空时间
                                clearInterval(timer);//清空计时器
                                setTimeout(function(){//延迟半秒执行
                                    $('.callOut1').html('转接成功');
                                    $('.callOut').html('通话结束');
                                    setTimeout(function(){
                                        $('.Callerid').css('display','none');
                                        $('.Callerid1').css('display','none');
                                        $('.dialPhone').css('display','none');
                                    },500);
                                },500);
                            }else{//转接失败
                                $('.transfer img').prop('src','img/softphone/phone/transfer.png');//咨询图标变暗
                                $('.transfer').find('p').css('color','#bbb');
                                transferIng = false;//咨询状态为false
                                $('.callOut1').html('转接失败');
                                setTimeout(function(){//延迟半秒执行
                                    $('.callOut1').html('');
                                    setTimeout(function(){
                                        $('.Callerid1').css('display','none');
                                        $('.dialPhone').css('display','none');
                                    },500);
                                },500);
                                toastr.error("转接失败，请联系管理员");
                            }
                            break;
                        case 5 ://双步会议
                            if(retValue=="0"){//会议已经建立，对方已经震铃
                                meeting = true ;//表示会议已经建立
                                transferIng = false;//咨询状态为false
                            }else{
                                $('.meeting img').prop('src','img/softphone/phone/tripartite.png') ;//咨询图标变暗
                                $('.meeting').find('p').css('color','#bbb') ;
                                $('.callOut1').html('会议连接失败') ;
                                meeting = false ;
                                setTimeout(function(){//延迟半秒执行
                                    $('.callOut1').html('会议关闭') ;
                                    setTimeout(function(){
                                        $('.Callerid1').css('display','none') ;
                                        $('.dialPhone').css('display','none') ;
                                    },500);
                                },500);
                                toastr.error("会议失败，请联系管理员");
                            }
                            break;
                        case 6 ://咨询
                            if(retValue=="0"){//咨询连接建立时
                                transferIng = true;//咨询状态为false
                                $('.callOut1').html('已连接,正在震铃') ;
                            }else{
                                $('.callOut1').html('无应答') ;
                                setTimeout(function(){//延迟半秒执行
                                    $('.callOut1').html('通话结束') ;
                                    transferIng = false;
                                    setTimeout(function(){
                                        $('.Callerid1').css('display','none') ;
                                        $('.dialPhone').css('display','none') ;
                                    },500);
                                },500);
                                toastr.error("咨询失败，请联系管理员");
                            }
                            break;
                        case 7 :
                            //retvaule(retValue,"单步转接");
                            break;
                        case 8 :
                            //retvaule(retValue,"单步会议");
                            break;
                        case 9 :
                            if(chatMessage == "签入"){
                                if(retValue=="0"){//签入成功
                                    $('.loginShow img').prop('src','/img/softphone/phone/chenggong.png') ;
                                    $('.loginShow img').prop("title","签出")
                                    $('.loginShow img').prop("alt","签出")
                                    $('.free img').prop('src','/img/softphone/phone/freeafter.png') ;
                                    toastr.success("签入成功")
                                }else{
                                    toastr.error("签入失败，请联系管理员");
                                }
                            }else if(chatMessage == "签出"){
                                if(retValue=="0"){//签出成功
                                    $('.loginShow img').attr('src','/img/softphone/phone/weidenglu.png') ;
                                    $('.loginShow img').prop("title","签入")
                                    $('.busy img').attr('src','/img/softphone/phone/busy.png') ;
                                    $('.free img').attr('src','/img/softphone/phone/free.png') ;
                                    $('.answer img').attr('src','/img/softphone/phone/Listening.png') ;
                                    $('.split img').attr('src','/img/softphone/phone/split.png') ;
                                    $('.dialout img').attr('src','/img/softphone/phone/dial.png') ;
                                    $('.hold img').attr('src','/img/softphone/phone/keep.png') ;
                                    $('.transfer img').attr('src','/img/softphone/phone/transfer.png') ;
                                    $('.meeting img').attr('src','/img/softphone/phone/tripartite.png') ;
                                    $('.satisfaction img').attr('src','/img/softphone/phone/satisfaction.png') ;
                                    toastr.success("签出成功")
                                }else{
                                    toastr.error("签出失败，请联系管理员");
                                }
                            }else if(chatMessage == "示忙"){
                                if(retValue=="0"){//示忙成功
                                    $('.busy img').prop('src','/img/softphone/phone/busyafter.png') ;
                                    $('.free img').prop('src','img/softphone/phone/free.png') ;
                                    toastr.success("示忙成功")
                                }else{
                                    toastr.error("示忙失败，请联系管理员");
                                }
                            }else if(chatMessage == "示闲"){
                                if(retValue=="0"){//示闲成功
                                    $('.free img').prop('src','/img/softphone/phone/freeafter.png');
                                    $('.busy img').prop('src','/img/softphone/phone/busy.png');
                                    toastr.success("示闲成功")
                                }else{
                                    toastr.error("示闲失败，请联系管理员");
                                }
                            }
                            break;
                        case 10 ://外呼
                            if(retValue=="0"){//外呼成功震铃时
                                //显示来电显示页面
                                $('.Callerid').css('display','block');
                                $('.callPhone').html(phoneNumber);
                                $('.Telephone').css('display','block');
                                // $('.phoneanswer').css('display','none');
                                //设置背景颜色为空
                                //$('.phoneanswer').css('dispaly','block');
                                $('.phoneanswer').css('background','#fff none repeat scroll 0 0');
                                $('.phoneanswer').html('');
                                $('.hangup_two').css('display','block');
                                //$('.Hangup').css('display','block');
                                $('.endListen').css('display','none');
                                $('.callOut').html('正在呼叫...');
                            }else{
                                toastr.error("外呼失败，请联系管理员");
                            }
                            break;
                        case 11 : //取消呼叫时
                            //if(retValue=="0"){}else{}
                            break;
                    }
                }

                //计算通话时间
                function setTime(time){
                    clearInterval(timer);
                    callTime = time;
                    $('.callTime').html('00:00');
                    $('.telTime').html('00:00');
                    timer = setInterval(function(){
                        callTime+=1;
                        callTimeseconds = callTime%60;
                        callTimeminutes = Math.floor(callTime/60);
                        if(callTimeseconds<10){
                            callTimeseconds ='0'+ callTimeseconds;
                        }else{
                            callTimeseconds = callTimeseconds+'';
                        }
                        if(callTimeminutes<10){
                            callTimeminutes ='0' + callTimeminutes;
                        }else{
                            callTimeminutes = callTimeminutes+'';
                        }
                        $('.callTime').html(callTimeminutes+':'+callTimeseconds);
                        $('.telTime').html(callTimeminutes+':'+callTimeseconds);
                    },1000);
                }

                /** 来电震铃事件
                 * @param ucid  //电话编号
                 * @param callingNo  //主叫号码
                 * @param calledNo  //被叫号码
                 * @param userData  //客户资料
                 **/
                function onInbound(ucid,callingNo,calledNo,userData){
                    console.info(userData+"pppppppppppppppppppppppppp");
                    $(".Callerid").css("display","block");
                    $('.callPhone').html(callingNo);
                    $('.callOut').html("来电地址");
                    $('.callTime').html("震铃中...");
                    $('.phoneanswer').css('background',' #5dca91 none repeat scroll 0 0');
                    $('.phoneanswer').html('接听');
                    clearInterval(timer);
                    //自动弹屏
                }

                function setAgentState(index) {
                    if (index == 0) {
                        var flag = $(".loginShow img").attr("title");
                        if (flag == "签入") {
                            chatMessage = "签入";
                            callserver.start().done(function () {//注册分机号
                                call.invoke("setAgentState", ext, agentNum, "0", '4', '').done(function (val) {//执行签入
                                });
                            });
                        } else if (flag == "签出") {
                            chatMessage = "签出";
                            callserver.start().done(function () {
                                call.invoke("setAgentState", ext, agentNum, "1", '4', '').done(function (val) {
                                });
                            });
                        }
                    }
                    ;
                    if (index == 2) {//示忙操作
                        var msg = $('.busy img').attr("src");
                        if (msg.indexOf("busyafter") == "-1") {
                            chatMessage = "示忙";
                            callserver.start().done(function () {
                                call.invoke("setAgentState", ext, agentNum, 2, '4', '').done(function (val) {
                                });
                            });
                        }
                    }
                    ;
                    if (index == 3) {
                        var msg = $('.free img').attr("src");
                        if (msg.indexOf("freeafter") == "-1") {
                            chatMessage = "示闲";
                            callserver.start().done(function () {
                                call.invoke("setAgentState", ext, agentNum, 3, '4', '').done(function (val) {
                                });
                            });
                        }
                    }
                }
            </script>
        </div>
        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li class="grey dropdown-modal">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="ace-icon fa fa-tasks"></i>
                        <span class="badge badge-grey">4</span>
                    </a>

                    <ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="ace-icon fa fa-check"></i>
                            4 Tasks to complete
                        </li>

                        <li class="dropdown-content">
                            <ul class="dropdown-menu dropdown-navbar">
                                <li>
                                    <a href="#">
                                        <div class="clearfix">
                                            <span class="pull-left">Software Update</span>
                                            <span class="pull-right">65%</span>
                                        </div>

                                        <div class="progress progress-mini">
                                            <div style="width:65%" class="progress-bar"></div>
                                        </div>
                                    </a>
                                </li>

                                <li>
                                    <a href="#">
                                        <div class="clearfix">
                                            <span class="pull-left">Hardware Upgrade</span>
                                            <span class="pull-right">35%</span>
                                        </div>

                                        <div class="progress progress-mini">
                                            <div style="width:35%" class="progress-bar progress-bar-danger"></div>
                                        </div>
                                    </a>
                                </li>

                                <li>
                                    <a href="#">
                                        <div class="clearfix">
                                            <span class="pull-left">Unit Testing</span>
                                            <span class="pull-right">15%</span>
                                        </div>

                                        <div class="progress progress-mini">
                                            <div style="width:15%" class="progress-bar progress-bar-warning"></div>
                                        </div>
                                    </a>
                                </li>

                                <li>
                                    <a href="#">
                                        <div class="clearfix">
                                            <span class="pull-left">Bug Fixes</span>
                                            <span class="pull-right">90%</span>
                                        </div>

                                        <div class="progress progress-mini progress-striped active">
                                            <div style="width:90%" class="progress-bar progress-bar-success"></div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown-footer">
                            <a href="#">
                                See tasks with details
                                <i class="ace-icon fa fa-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="purple dropdown-modal">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="ace-icon fa fa-bell icon-animated-bell"></i>
                        <span class="badge badge-important">8</span>
                    </a>

                    <ul class="dropdown-menu-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="ace-icon fa fa-exclamation-triangle"></i>
                            8 Notifications
                        </li>

                        <li class="dropdown-content">
                            <ul class="dropdown-menu dropdown-navbar navbar-pink">
                                <li>
                                    <a href="#">
                                        <div class="clearfix">
													<span class="pull-left">
														<i class="btn btn-xs no-hover btn-pink fa fa-comment"></i>
														New Comments
													</span>
                                            <span class="pull-right badge badge-info">+12</span>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <i class="btn btn-xs btn-primary fa fa-user"></i>
                                        Bob just signed up as an editor ...
                                    </a>
                                </li>
                                <li>
                                    <a href="#">
                                        <div class="clearfix">
													<span class="pull-left">
														<i class="btn btn-xs no-hover btn-success fa fa-shopping-cart"></i>
														New Orders
													</span>
                                            <span class="pull-right badge badge-success">+8</span>
                                        </div>
                                    </a>
                                </li>

                                <li>
                                    <a href="#">
                                        <div class="clearfix">
													<span class="pull-left">
														<i class="btn btn-xs no-hover btn-info fa fa-twitter"></i>
														Followers
													</span>
                                            <span class="pull-right badge badge-info">+11</span>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown-footer">
                            <a href="#">
                                See all notifications
                                <i class="ace-icon fa fa-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="green dropdown-modal">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="ace-icon fa fa-envelope icon-animated-vertical"></i>
                        <span class="badge badge-success">5</span>
                    </a>

                    <ul class="dropdown-menu-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="ace-icon fa fa-envelope-o"></i>
                            5 Messages
                        </li>

                        <li class="dropdown-content">
                            <ul class="dropdown-menu dropdown-navbar">
                                <li>
                                    <a href="#" class="clearfix">
                                        <img src="assets/images/avatars/avatar.png" class="msg-photo" alt="Alex's Avatar" />
                                        <span class="msg-body">
													<span class="msg-title">
														<span class="blue">Alex:</span>
														Ciao sociis natoque penatibus et auctor ...
													</span>

													<span class="msg-time">
														<i class="ace-icon fa fa-clock-o"></i>
														<span>a moment ago</span>
													</span>
												</span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="clearfix">
                                        <img src="assets/images/avatars/avatar3.png" class="msg-photo" alt="Susan's Avatar" />
                                        <span class="msg-body">
													<span class="msg-title">
														<span class="blue">Susan:</span>
														Vestibulum id ligula porta felis euismod ...
													</span>

													<span class="msg-time">
														<i class="ace-icon fa fa-clock-o"></i>
														<span>20 minutes ago</span>
													</span>
												</span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="clearfix">
                                        <img src="assets/images/avatars/avatar4.png" class="msg-photo" alt="Bob's Avatar" />
                                        <span class="msg-body">
													<span class="msg-title">
														<span class="blue">Bob:</span>
														Nullam quis risus eget urna mollis ornare ...
													</span>

													<span class="msg-time">
														<i class="ace-icon fa fa-clock-o"></i>
														<span>3:15 pm</span>
													</span>
												</span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="clearfix">
                                        <img src="assets/images/avatars/avatar2.png" class="msg-photo" alt="Kate's Avatar" />
                                        <span class="msg-body">
													<span class="msg-title">
														<span class="blue">Kate:</span>
														Ciao sociis natoque eget urna mollis ornare ...
													</span>

													<span class="msg-time">
														<i class="ace-icon fa fa-clock-o"></i>
														<span>1:33 pm</span>
													</span>
												</span>
                                    </a>
                                </li>

                                <li>
                                    <a href="#" class="clearfix">
                                        <img src="assets/images/avatars/avatar5.png" class="msg-photo" alt="Fred's Avatar" />
                                        <span class="msg-body">
													<span class="msg-title">
														<span class="blue">Fred:</span>
														Vestibulum id penatibus et auctor  ...
													</span>

													<span class="msg-time">
														<i class="ace-icon fa fa-clock-o"></i>
														<span>10:09 am</span>
													</span>
												</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown-footer">
                            <a href="inbox.html">
                                See all messages
                                <i class="ace-icon fa fa-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="light-blue dropdown-modal">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo" th:src="@{/img/user/admin.png}" th:if="${session.user.userImg==null}">
                        <img class="nav-user-photo" th:src="@{${session.user.userImg}}" th:if="${session.user.userImg!=null}">
                        <!--<img class="nav-user-photo" src="assets/images/avatars/user.jpg"  />-->
                        <span class="user-info">
                            <small ><shiro:principal property="name"/></small>
								</span>

                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>

                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="javascript:edUserImg()">
                                <i class="ace-icon fa fa-camera-retro"></i>
                                修改头像
                            </a>
                        </li>
                        <li>
                            <a href="javascript:edUser()">
                                <i class="ace-icon fa fa-user"></i>
                                修改资料
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="/logout">
                                <i class="ace-icon fa fa-power-off"></i>
                                退出登录
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div><!-- /.navbar-container -->
</div>
<div class="str2 str_wrap" style="display: none" >
</div>
<div class="main-container ace-save-state" id="main-container">
    <script type="text/javascript">
        try{ace.settings.loadState('main-container')}catch(e){}
    </script>

    <div id="sidebar" class="sidebar   responsive  ace-save-state">
        <script type="text/javascript">
            try{ace.settings.loadState('sidebar')}catch(e){}
        </script>
        <div class="sidebar-shortcuts" id="sidebar-shortcuts">
            <div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
                <button class="btn btn-success" onclick="window.open('/report_total_everydays')" title="业务报表">
                    <i class="ace-icon fa fa-signal"></i>
                </button>

                <button class="btn btn-info">
                    <i class="ace-icon fa fa-pencil"></i>
                </button>

                <button class="btn btn-warning" onclick="window.open('/knowMain')" title="知识库">
                    <i class="ace-icon fa fa-users"></i>
                </button>

                <button class="btn btn-danger">
                    <i class="ace-icon fa fa-cogs"></i>
                </button>
            </div>

            <div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
                <span class="btn btn-success"></span>

                <span class="btn btn-info"></span>

                <span class="btn btn-warning"></span>

                <span class="btn btn-danger"></span>
            </div>
        </div><!-- /.sidebar-shortcuts -->

        <ul class="nav nav-list">
            <li shiro:hasPermission='main:view' class="">
                <a href="javascript:void(0);" onclick="siMenu('tab1_index1','主页','/default')">
                    <i class="menu-icon fa fa-tachometer"></i>
                    <span class="menu-text"> 主页 </span>
                </a>
                <b class="arrow"></b>
            </li>
            <li class="" shiro:hasPermission="workorder:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-bell"></i>
                    <span class="menu-text">工单处理</span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" >
                        <a href="javascript:void(0);"  onclick="siMenu('1','录音关联工单','/workorderRecord')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            录音关联工单
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-hand-create:view" >
                        <a  href="javascript:void(0);" onclick="siMenu('2','手动创建工单','/workorderHandCreate')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            手动创建工单
                        </a>
                        <b class="arrow"></b>
                    </li>

                    <li class="" shiro:hasPermission="workoder-control:view">
                        <a href="javascript:void(0);" onclick="siMenu('3','热线工单监控','/workoderControl')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            热线工单监控
                        </a>
                        <b class="arrow"></b>
                    </li>

                    <li class=""     shiro:hasPermission="workorder-son-search:view" >
                        <a href="javascript:void(0);" onclick="siMenu('4','系统用户','/workorderSonSearch')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            热线子单查询
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-create:view">
                        <a href="javascript:void(0);" onclick="siMenu('5','创建工单','/workorderCreate')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            创建工单
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-todeal:view">
                        <a href="javascript:void(0);" onclick="siMenu('6','代办工单','/workorderToDeal')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            代办工单
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-complete:view">
                        <a href="javascript:void(0);" onclick="siMenu('7',' 已办工单','/workorderComplete')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            已办工单
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-create-import:view">
                        <a href="javascript:void(0);" onclick="siMenu('8','  导入创建工单','/workorderCreateImport')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            导入创建工单
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-control-see:view">
                        <a href="javascript:void(0);" onclick="siMenu('9','  监控操作查看','/workorderControlSee')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            监控操作查看
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-check-count:view">
                        <a href="javascript:void(0);" onclick="siMenu('10','  监控操作查看','/workorderCheckCount')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            校正工单显示次数
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-check-score:view">
                        <a href="javascript:void(0);" onclick="siMenu('11','   考核计分表','/workorderCheckScore')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            考核计分表
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-selective:view">
                        <a href="javascript:void(0);" onclick="siMenu('12','    抽单记录查询','/workorderSelective')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            抽单记录查询
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="workorder-notified:view">
                        <a href="javascript:void(0);" onclick="siMenu('13','通报','/workorderNotified')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            通报
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>

            <li class="" shiro:hasPermission="info:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-bus"></i>
                    <span class="menu-text"> 信息管理 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="busSite:view">
                        <a href="javascript:void(0);" onclick="siMenu('20','站点管理','/toBusSite')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            站点管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-bus:view">
                        <a href="javascript:void(0);" onclick="siMenu('14','乘车查询','/infoBus')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            乘车查询
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-bus-line:view">
                        <a href="javascript:void(0);" onclick="siMenu('15','线路管理','/infoBusLine')" >
                            <i class="menu-icon fa fa-caret-right"></i>
                            线路管理
                        </a>

                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="bigsreen:view">
                        <a href="javascript:void(0);" onclick="siMenu('16','批注管理','/infoAnnotation')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            批注管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-bus-remark:view">
                        <a href="javascript:void(0);" onclick="siMenu('17','备注管理','/infoBusRemark')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            备注管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-bus-remark:view">
                        <a href="javascript:void(0);" onclick="siMenu('18','统计数据管理','/infoBusRemark')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            统计数据管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-intersite:view">
                        <a href="javascript:void(0);" onclick="siMenu('19','站间数据管理','/infoIntersite')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            站间数据管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-telephone-book:view">
                        <a href="javascript:void(0);" onclick="siMenu('19','电话簿管理','/infoTelephoneBook')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            电话簿管理
                        </a>
                        <b class="arrow"></b>
                    </li>

                    <li class="" shiro:hasPermission="info-attachment:view">
                        <a href="javascript:void(0);" onclick="siMenu('21','附件管理','/infoAttachment')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            附件管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="info-configure-data:view">
                        <a href="javascript:void(0);" onclick="siMenu('22','数据配置','/infoConfigureData')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            数据配置
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="" shiro:hasPermission="customer:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-user"></i>
                    <span class="menu-text"> 客户管理 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="customer:view">
                        <a href="javascript:void(0);" onclick="siMenu('23','客户管理','/toCust')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            客户管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>

            <li class="" shiro:hasPermission="quality:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-microphone"></i>
                    <span class="menu-text"> 质检 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="quality-check-record:view">
                        <a href="javascript:void(0);"  onclick="siMenu('24','录音质检','/qualityCheckRecord')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            录音质检
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="quality-result:view">
                        <a href="javascript:void(0);"  onclick="siMenu('25','抽查','/qualityResult')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            抽查
                        </a>
                        <b class="arrow"></b>
                    </li>

                </ul>
            </li>
            <li class="" shiro:hasPermission="record:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-bar-chart"></i>
                    <span class="menu-text">  录音报表 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="records:view">
                        <a href="javascript:void(0);"  onclick="siMenu('28','录音调听','/record')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            录音调听
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="ivr:view">
                        <a href="javascript:void(0);"  onclick="siMenu('29','ivr轨迹','/ivr')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            ivr轨迹
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class=""  shiro:hasPermission="satisfaction:view">
                        <a href="javascript:void(0);"  onclick="siMenu('30','满意度查询','/satisfaction')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            满意度查询
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="" shiro:hasPermission="notice:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-bullhorn"></i>
                    <span class="menu-text">  公告 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="notice:view">
                        <a href="javascript:void(0);"  onclick="siMenu('31','公告管理','/toNotice')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            公告管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="" shiro:hasPermission="hr:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-sitemap"></i>
                    <span class="menu-text">  人力资源 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="deps:view">
                        <a href="javascript:void(0);"  onclick="siMenu('32','组织机构','/deps/0')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            组织机构
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="user:view">
                        <a href="javascript:void(0);"  onclick="siMenu('33','员工管理','/toUser')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            员工管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="holiday-type:view">
                        <a href="javascript:void(0);"  onclick="siMenu('34','假期类型','/holidayType')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            假期类型
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="holiday-manager:view">
                        <a href="javascript:void(0);"  onclick="siMenu('35','假期管理','/holidayManager')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            假期管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="" shiro:hasPermission="permission:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-gear"></i>
                    <span class="menu-text">功能权限 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="role:view">
                        <a href="javascript:void(0);"  onclick="siMenu('36',' 角色管理','/roles/1')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            角色管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="perms:view">
                        <a href="javascript:void(0);"  onclick="siMenu('37','权限管理','/perms/0')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            权限管理
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
            <li class="" shiro:hasPermission="data:view">
                <a href="#" class="dropdown-toggle">
                    <i class="menu-icon fa fa-database"></i>
                    <span class="menu-text">数据维护 </span>
                    <b class="arrow fa fa-angle-down"></b>
                </a>
                <b class="arrow"></b>
                <ul class="submenu">
                    <li class="" shiro:hasPermission="option:view">
                        <a href="javascript:void(0);"  onclick="siMenu('38','选项配置','/toType/0')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            选项配置
                        </a>
                        <b class="arrow"></b>
                    </li>
                    <li class="" shiro:hasPermission="blacklist:view">
                        <a href="javascript:void(0);"  onclick="siMenu('39','黑名单维护','/blacklist')">
                            <i class="menu-icon fa fa-caret-right"></i>
                            黑名单维护
                        </a>
                        <b class="arrow"></b>
                    </li>
                </ul>
            </li>
			<li class="">
			    <a href="#" class="dropdown-toggle">
			        <i class="menu-icon fa fa-calendar"></i>
			        <span class="menu-text">日程 </span>
			        <b class="arrow fa fa-angle-down"></b>
			    </a>
			    <b class="arrow"></b>
			    <ul class="submenu">
			        <li class="">
			            <a href="javascript:void(0);"  onclick="siMenu('40','日程编辑','./toSchedule')">
			                <i class="menu-icon fa fa-caret-right"></i>日程编辑
			            </a>
			            <b class="arrow"></b>
			        </li>
			        <li class="">
			            <a href="javascript:void(0);"  onclick="siMenu('41','班次列表','./toShift')">
			                <i class="menu-icon fa fa-caret-right"></i>班次列表
			            </a>
			            <b class="arrow"></b>
			        </li>
			    </ul>
			</li>
			<li class="">
			    <a href="#" class="dropdown-toggle">
			        <i class="menu-icon fa fa-calendar"></i>
			        <span class="menu-text">巴士之友 </span>
			        <b class="arrow fa fa-angle-down"></b>
			    </a>
			    <b class="arrow"></b>
			    <ul class="submenu">
			        <li class="">
			            <a href="javascript:void(0);"  onclick="siMenu('42','友人会员','/toFriendMember')">
			                <i class="menu-icon fa fa-caret-right"></i>会员列表
			            </a>
			            <b class="arrow"></b>
			        </li>
			        <li class="">
			            <a href="javascript:void(0);"  onclick="siMenu('43','友人活动','/toFriendEvent')">
			                <i class="menu-icon fa fa-caret-right"></i>活动列表
			            </a>
			            <b class="arrow"></b>
			        </li>
			    </ul>
			</li>
        </ul><!-- /.nav-list -->
        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>
    </div>
    <div class="main-content">
        <div class="main-content-inner">
            <div class="page-content">
                <div class="ace-settings-container" id="ace-settings-container">
                    <div class="btn btn-app btn-xs btn-warning ace-settings-btn" id="ace-settings-btn">
                        <i class="ace-icon fa fa-cog bigger-130"></i>
                    </div>
                    <div class="ace-settings-box clearfix" id="ace-settings-box">
                        <div class="pull-left width-50">
                            <div class="ace-settings-item">
                                <div class="pull-left">
                                    <select id="skin-colorpicker" class="hide">
                                        <option data-skin="no-skin" value="#438EB9">#438EB9</option>
                                        <option data-skin="skin-1" value="#222A2D">#222A2D</option>
                                        <option data-skin="skin-2" value="#C6487E">#C6487E</option>
                                        <option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
                                    </select>
                                </div>
                                <span>&nbsp; 皮肤</span>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-navbar" autocomplete="off" />
                                <label class="lbl" for="ace-settings-navbar"> 固定导航</label>
                            </div>
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-sidebar" autocomplete="off" />
                                <label class="lbl" for="ace-settings-sidebar"> 固定边栏</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-breadcrumbs" autocomplete="off" />
                                <label class="lbl" for="ace-settings-breadcrumbs"> 固定面包屑</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" autocomplete="off" />
                                <label class="lbl" for="ace-settings-rtl"> 右侧目录</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2 ace-save-state" id="ace-settings-add-container" autocomplete="off" />
                                <label class="lbl" for="ace-settings-add-container">
                                    <b>中间</b>
                                </label>
                            </div>
                        </div>

                        <div class="pull-left width-50">
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-hover" autocomplete="off" />
                                <label class="lbl" for="ace-settings-hover"> 悬停菜单</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-compact" autocomplete="off" />
                                <label class="lbl" for="ace-settings-compact"> 紧凑边栏</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-highlight" autocomplete="off" />
                                <label class="lbl" for="ace-settings-highlight"> 活动项目</label>
                            </div>
                        </div><!-- /.pull-left -->
                    </div><!-- /.ace-settings-box -->
                </div><!-- /.ace-settings-container -->

                <div class="row">
                    <div id="jzts" style="display:none; width:100%; position:fixed; z-index:99999999;">
                        <div class="commitopacity" id="bkbgjz"></div>
                        <div class="jzts">
                            <div style="float: left;margin-top: 3px;"><img th:src="@{img/loadingi.gif}"> </div>
                            <div style="margin-top: 6px;"><h4 class="lighter block red">&nbsp;加载中 </h4></div>
                        </div>
                    </div>
                    <iframe name="mainFrame" id="mainFrame" frameborder="0"  src="/tab" style="margin:0 auto;width:100%;"></iframe>
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div>
    </div><!-- /.main-content -->

    <div class="footer">
        <div class="footer-inner">
            <div class="footer-content">
               <span class="bigger-120">
                   <span class="blue bolder">Crm</span>
                   深圳巴士集团股份有限公司 &copy; 2018-2019
               </span> &nbsp; &nbsp;
                <span class="action-buttons">
                    <a href="#">
                        <i class="ace-icon fa fa-twitter-square light-blue bigger-150"></i>
                    </a>
                    <a href="#">
                        <i class="ace-icon fa fa-facebook-square text-primary bigger-150"></i>
                    </a>
                    <a href="#">
                        <i class="ace-icon fa fa-rss-square orange bigger-150"></i>
                    </a>
                </span>
            </div>
        </div>
    </div>
    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->
<!-- basic scripts -->
<script th:src="@{js/jquery-2.1.4.min.js}"></script>
<script th:src="@{js/bootstrap.min.js}" ></script>
<script th:src="@{js/ace/ace-elements.min.js}" ></script>
<script th:src="@{js/ace/ace.min.js}" ></script>
<script th:src="@{plugins/dialog/drag.js}" ></script>
<script th:src="@{plugins/dialog/dialog.js}" ></script>
<script th:src="@{js/jquery.liMarquee.js}"></script>
<script th:inline="javascript">
    $(function () {
        $(".str2").css("height","23px");
    })
    var  websocket = null;
    if('WebSocket' in window){
        websocket = new WebSocket("ws://localhost:8081/websocket/"+[[${session.user.number}]])
    }else{
        alert("该浏览器不支持websocket")
    }
    websocket.onopen = function(event){
        console.log('建立连接')
    }

    websocket.onclose = function(event){
        console.log('连接关闭')
    }

    websocket.onmessage = function(event){
        console.log('收到消息:'+event.data);
        $('.str2').css("display","block");
        $('.str2').html(event.data);
        $('.str2').liMarquee({
            direction: 'right'
        });
        setTimeout(function(){
            $('.str2').css("display","none");
            $('.str2').liMarquee('destroy');
        }, 30000);

    }

    websocket.onerror = function(){
        console.log("websocket发生通信错误");
    }

    websocket.onbeforeunload = function(event){
        websocket.close()
    }

    function edUser() {
        showMask();
        var diag = new Dialog();
        diag.Drag = true;
        diag.Title = "编辑用户";
        diag.ShowMaxButton = true;	//最大化按钮
        diag.ShowMinButton = true;
        diag.URL = "/eUser";
        diag.Width = 469;
        diag.Height = 465;
        diag.CancelEvent = function(){ //关闭事件
            hideMask();
            setTimeout("self.location.reload()",100);
            diag.close();
        };
        diag.show();
    }
    function edUserImg() {
        showMask();
        var diag = new Dialog();
        diag.Drag = true;
        diag.Title = "编辑用户头像";
        diag.ShowMaxButton = true;	//最大化按钮
        diag.ShowMinButton = true;
        diag.URL = "/eUserImg";
        diag.Width = 386;
        diag.Height = 310;
        diag.CancelEvent = function(){ //关闭事件
            hideMask();
            setTimeout("self.location.reload()",100);
            diag.close();
        };
        diag.show();
    }
    function cmainFrame(){
        var hmain = document.getElementById("mainFrame");
        var bheight = window.innerHeight;
        hmain .style.width = '100%';
        hmain .style.height = (bheight - 45-38) + 'px';
        var bkbgjz = document.getElementById("bkbgjz");
        bkbgjz .style.height = (bheight  - 45) + 'px';
    }
    cmainFrame();
    window.onresize=function(){
        cmainFrame();
    };
    function siMenu(id,MENU_NAME,MENU_URL){
        top.mainFrame.tabAddHandler(id,MENU_NAME,MENU_URL);
        showMask();
    }
    //清除加载进度
    function hideMask(){
        $("#jzts").hide();
    }
    //显示加载进度
    function showMask(){
        $("#jzts").show();
    }
</script>
</body>
</html>
